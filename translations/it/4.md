# Chapter 4

# The Monero network

In this chapter, you'll learn the key concepts behind blockchain technology and how Monero miners keep the ledger secure. We'll begin by explaining the structure of blocks, the way that they're linked into a tamper-proof chain, and how the miners use proof of work to arrive at consensus on an agreed version of the ledger. On the topic of miners, we'll discuss the source of new moneroj, and how the coins are released into the ecosystem. Toward the end of the chapter, we'll dip our toes into a few cryptography concepts (hashes and nonces) to really grasp the actual process of mining.

## 4.1 The simplified anatomy of a block

The previous chapter discussed how transactions are constructed. In summary, your wallet drafts a message with instructions to transfer one of your outputs to a new recipient. Sensitive information in the message (sender, receiver, amount) is cryptographically obscured, before your wallet authorizes the message by digitally signing it with your private key.

In this chapter, you'll learn how the transaction message is processed to enact the actual transfer. When your wallet broadcasts this message, the network temporarily stores the request in a list of pending transactions known as the memory pool. The Monero miners collect these unconfirmed transactions from the memory pool, and bundle them together into blocks. A simplified block is shown below:

[![Figure 4.1](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i01%20block.png)](https://masteringmonero.com)
> Figure 4.1 - Each sequentially-numbered block of transactions must include both a nonce and a reference to the hash of the previous block. 

Each block contains a set of transactions, a cryptographic link to the previous block (called a hash), and a place for the miner to include a special number that completes the block (called a nonce).

If you want to learn how hashes and nonces work, there is a friendly introduction with examples toward the end of this chapter (you can skip ahead to the last section of chapter 4, and read it now if you're curious about the cryptography.) There are only two concepts that you need to know in order to understand how these techniques function to secure the blockchain:

1) The hash is a security feature proving that each block is directly linked to an unaltered version of the previous block. If an attacker tries to tamper with any point in the ledger, even the smallest modification attempt will be blatantly obvious because the hashes will raise a red flag on every subsequent block.

2) The nonce is a special string that completes the block and marks it as prepared for the blockchain. It is extremely computationally difficult to find a nonce that satisfies the requirements necessary to finalize and seal a block. Miners spend most of their time and energy searching for valid nonces. It is impossible to plan ahead for calculating the nonces, so the search must start from scratch with each new block. Nonces are not mathematically meaningful; only one-time strings of random characters.

## 4.2 Nodes are the network backbone

### 4.2.1 Nodes relay network data to peers

Until now, references to “the Monero network” have mostly glossed over the details of its composition. How do your transactions actually propagate across this nebulous “network” to miners and other users? Thousands of Monero nodes scattered across the planet are connected to each other, quickly sharing news of transactions and blocks.

These nodes form a peer-to-peer network, enabling efficient and resilient communication for Monero users. Running a node does not require any special equipment or expertise - if you download and begin installing the Monero software now, you can have your own node running before you finish reading this chapter!

[![Figure 4.2](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i04%20nodes.png)](https://masteringmonero.com)
> Figure 4.2 - Monero uses a distributed peer-to-peer network, comprised of a web of volunteer devices sharing new data with each other. Nodes retain a full copy of the blockchain and create the backbone of the network. Since running a node requires significant disk space, some devices (especially mobile wallets) instead connect to a remote node to request information and broadcast transactions.

There are no “special” or “super” nodes in Monero's peer-to-peer network; all nodes (including yours) are equal participants working to share resources and the workload. Nodes are hosted on computers of all shapes and sizes - laptops, desktops, servers, and even virtual machines.

### 4.2.2 Nodes store the blockchain

When a new node is initialized, it must first download the entire blockchain and verify the cryptographic links, such as the hashes and nonces. This initial sync may take a few hours, as the node builds its local copy of the blockchain, while confirming the validity of each transaction and block. Instead of downloading the blockchain over a single connection to a central source, each node receives transmissions from many peer nodes. Nodes do not need to identify or trust their peers, since the validity of the data is confirmed cryptographically.

Any Monero wallet software (e.g. the Monero GUI, a phone app, etc) must have access to a copy of the blockchain in order to carry out key tasks like retrieving transaction history, calculating account balances, and crafting transactions. A wallet cannot craft transactions before communicating with a synchronized node, since the software needs to find and tally the relevant unspent outputs. However, your address can receive moneroj whether or not you are connected to a synced node (it simply won't show up in your balance until the wallet downloads & verifies that block).

### 4.2.3 “Local nodes” versus “remote nodes”

The process of locally storing/verifying the entire blockchain so that your wallet can interact with your own copy of the ledger is referred to as running a local node. When you use this type of setup, your wallet only interacts with your personal copy of the blockchain. Running a local node requires a fair amount of disk space (~70 GB at the time of writing), which is not suitable for all devices, such as cell phones.

Thankfully, wallet software can be configured to use a remote node instead of your own local node. This means that your wallet will connect to somebody else's node and simply request information about your outputs. Most mobile Monero wallets default to using a remote node, in order to keep the app lightweight. The Monero GUI and CLI wallets can be configured to use either a local node or remote node.

There are no security risks in using a remote node; your seed and keys are never revealed, so the remote node operator will not be able to control your funds or decrypt any information that is protected by Monero features such as RingCT (concealing transaction amount) or stealth addresses (obfuscating recipient address).

There are some minor privacy concessions that come into play when using remote nodes, since the node operator is aware of the times and IP addresses from which your device broadcasts transactions or connects for updates. Connecting to the node via a VPN or TOR will partially mitigate these mitigate these risks. If you use your own local node, your wallet scans your personal copy of the blockchain for your transaction history, instead of relying on a third party to retrieve this information.

## 4.3 Miners create new blocks

### 4.3.1 Miners add new blocks onto the longest chain

The miners collect pending transactions from the memory pool, verify their authenticity by checking that the cryptographic proofs and signatures are valid, and check that the key image has not been used before (see “3.2.3 Ring signatures,” to review why this is important). 

To prepare a block, the miner drafts a list of transactions to be included, along with the hash of the previous block to provide a cryptographic link. Lastly, the miner labors to find a nonce that can be used to complete the block.

At any given moment, there are thousands of miners all working separately (or in teams, known as mining pools) to find a nonce that completes the current block of transactions. As soon as a miner or pool finds a nonce to finalize their block, they announce their version to the rest of the network. Upon receiving this completed block, the other miners and nodes append it to their copy of the blockchain, increasing the chain's height by one block. Transactions referenced by the new block are removed from the memory pool, and the other miners discard their own (incomplete) work on that block to begin preparing the next one.

### 4.3.2 A difficult task ensures stability and fairness

The global nature of the Monero ecosystem and unpredictable transmission delays due to network latency occasionally cause momentary splits in the blockchain, if two miners independently complete two different versions of a block at the same height. Suppose a miner in South America is the first to complete a block, but a different miner in Europe finishes their own copy before receiving the broadcast from South America. In this case, the western hemisphere may be temporarily using a different blockchain than the eastern hemisphere. For a brief moment, there exist two competing Monero ledgers that might have slight differences (depending on which pending transactions each miner selected from the memory pool). One might think that this would be a catastrophic occurrence!

[![Figure 4.3](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i02%20longest%20chain.png)](https://masteringmonero.com)

> Figure 4.3 - Miners compete to extend the chain with a new block.
(Top) The blockchain is at height “3” so each miner works on their version of block “4”.
(Bottom) Block “4” was completed by the middle miner first, so their version is added to the shared blockchain, and all miners switch to finding a nonce for block “5”.

On the contrary, this situation is easily resolved by elegantly imposing a simple rule: miners all agree to work on the mining the next block in the longest chain. This is a key piece of Monero's decentralized consensus protocol, and allows the Monero network to nimbly reunite to a single chain after an accidental split. Instead of trying to resolve the discrepant blocks immediately, the miners simply continue working on completing the next block for their version. 

Within the next few minutes, one of the miners will solve a subsequent block and add it to their chain. As soon as this occurs, their version becomes the longest chain, so the other miners and nodes quickly adopt that copy and discard the alternative orphaned block. Any transactions that were only included the orphaned block remain in the memory pool for the main chain, and will be mined in a subsequent block. By simply following the longest chain created with the most effort, the network completely resolves any splits and returns to consensus on a single universal ledger.

### 4.3.3 Monero “taxis” use a hard puzzle to ensure fairness

Validating a set of transactions and listing them in a block is not computationally difficult. The time-consuming task for the miner is finding a nonce that allows them to complete the block. This is a puzzle designed to be extremely challenging and solvable only by brute force testing solutions; there is no way to shortcut the process or mathematically narrow down the search for a valid nonce. Miners simply pick random numbers and test whether they complete the block, by trial and error.

The presence of this arbitrary obstacle may seem peculiar at first! The miners carry out a crucial and computationally-easy role for the network (validating transactions) but are required to carry out a useless difficult task (finding the nonce) in order to submit their results.

To understand the reasoning behind this, consider the hypothetical Monero Taxicab Network with only a few vehicles, and many taxi drivers that can temporarily utilize one of the cabs if they submit an approved route. Throughout the day, potential riders call in and request rides all over the city. All of the requests from riders who have not been picked up are collected in a real-time “pool” of pending rides.

[![Figure 4.4](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i05%20rides.png)](https://masteringmonero.com)
> Figure 4.4 - In the first stage of preparing a ride plan, each driver looks at the pool of pending rides and drafts up a route.

Instead of a central taxi authority assigning each incoming ride to a car or driver, each taxi driver looks at the pool and puts together their own list of 5 - 10 trips that they could complete in the next 30 minutes. This part of route/ride planning is easy and fast for experienced taxi drivers! Once a driver puts together a list of trips that they can include in their next “block” of rides, they complete a final task described below, then submit their route to the Monero Taxicab Network.

If the driver has proposed a valid route with real pending riders, then the plan is approved! The riders included on the taxi driver's plan are removed from the pending pool, the taxi driver checks out a vehicle, and travelers are soon shuttled to their destinations. The driver collects fare from each of the riders, and receives a cash bonus from the Monero Taxicab Network for being the first to submit a complete plan.
So far, this should seem fairly intuitive! Incomplete trips are listed in a pool; when a taxi driver successfully submits an approved block of trips, the riders are transported to their destinations and removed from the pending pool.

[![Figure 4.5](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i06%20scrabble.png)](https://masteringmonero.com)
> Figure 4.5 - After the drivers complete the (relatively) easy task of planning a route, they must solve a difficult puzzle - in this analogy, finding a way to rearrange letters from the addresses to create a sentence.

However, the Monero Taxicab Network has a very peculiar rule: in order for a driver to submit their plan for a block of rides to the Monero Network, they must do some difficult useless task first. Imagine that the driver must scramble all of the letters in the riders' destination addresses and use some of them to generate five sentences (> 50 words total) that can say anything, but must have correct grammar/spelling in the local language. A driver submitting a planned route must include both the list of rides and the nonsense (“nonce”) sentences that match the letters in the destinations, or else their route will be automatically rejected. There are multiple valid nonce phrases that can be constructed from most sets of letters (for example {a,e,e,g,i,m,n,r,r,s,t,o,o} can be rearranged to form both “Rims enrage too!” and “Monero is great!”), and the resulting sentences are absolutely useless for anything besides submitting that set of rides to the Monero Taxicab Network.

A property of this type of task, which will have parallels in the Monero cryptocurrency, is that it is very hard to find a nonce, and very easy to verify one. For this taxi scenario, is quite difficult to rearrange a dozen addresses by hand into 50 words that form valid sentences. However, it is trivial for somebody else to review the nonce result and verify that it completes the block of rides. When a driver submits their nonce in the format shown below, you can very quickly confirm that “Apple jam is very bad” is a valid sentence, and that the letters are properly constructed from the rider destinations. This verification is nearly instantaneous, compared to the time it took the driver to rearrange the letters and find several sentences.

[![Figure 4.6](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i07%20nonce.png)](https://masteringmonero.com)
> Figure 4.6 - Finding a nonce sentence by rearranging the addresses is tricky and time-consuming. However, the validity of a submission is easy to verify by quickly checking that it only uses letters from the rides included in the route.

A seasoned taxi driver would be able to plan the driving route from the trip list in less than 60 seconds, however it will probably take them a few minutes to rearrange the letters and find nonce sentences by hand. In fact, most of their effort in preparing their proposed block of rides will be spent on finding this useless nonce.

Imagine this process from a taxi driver's perspective, beginning right after the last block was approved. You quickly create a route that includes several trips from the list of pending rides. Then you begin working furiously to rearrange letters from the destinations into some kind of nonce sentence. For a few minutes, you and all of the other taxi drivers are working on the same list of pending rides, each trying to craft a long enough nonce with more than 50 words. Suddenly, a different driver submits a list of the rides along with a completed nonce. All of the trips that you were working on disappear from the pool! You must throw away your work on that block (since the riders are already en route) and switch to a new set of pending trips. The process to find a valid nonce for that set of riders begins again from scratch, based on the new set of letters in their destinations.

Why would the Monero Taxicab Network impose such a difficult useless task upon their drivers? It is actually their surefire way to ensure that customers are served fairly! Imagine that a few of the taxi drivers behave unethically in some way, perhaps ignoring pending rides called in from a certain part of town, or selecting only the riders that are going to businesses that have bribed those unfair drivers. Without the nonce requirement, these small groups or individual malicious drivers might dominate the ride selection process for the whole business by constantly submitting their (unfair or exclusionary) routes as soon as a car becomes available. In this way, they could systematically treat some groups of customers poorly, which is absolutely antithetical to the core principles of the Monero Taxicab Network, which is dedicated to serving all riders fairly. 

The nonce task competition between many taxi drivers is crucial to Monero's goal of ensuring that cars and rides are provided fairly. Assuming that all of the taxi drivers can rearrange letters at roughly the same speed as each other, it will be somewhat random which driver lucks into a solution and is able to submit their block of plans first. It is unlikely that any driver could be the first to submit multiple block plans in a row (i.e. be the first to find nonce sentences for several sequential blocks) since each driver is competing against, and collectively outnumbered by, all of the other drivers.

Most of the multitude of potential drivers will be honest individuals, submitting fair ride block plans to keep the city running smoothly. If there are a few malicious drivers who wish to submit unfair plans, the nonce task prevents them from controlling the entire system. Statistically, they will occasionally be the first to find the nonce, and thus able to submit their exclusionary route plan for that block. However, the rest of the drivers, most of whom are honest, will immediately begin working on their fair blocks to propose for the next set of rides! Due to the random nature of who lucks into finding a nonce first, the next set of rides will probably be carried out by an honest driver whose plan will incorporate the previously-excluded trips. This system of imposing useless work to randomize which drivers' routes are accepted allows the Monero Taxicab Network to be sure that a minority of malicious drivers cannot block a user or group from booking rides.

The Monero Taxicab Network thus has no central authority that is responsible or liable for controlling ride activity and assignment. Instead, this task is distributed to the individual drivers, employing the useless nonce competition to randomly select which route proposal is accepted. This statistically ensures that the cars are frequently assigned to honest drivers, so the Monero Taxicab Network has an excellent reputation for providing fair service to all customers.

By now you're probably wondering how this extended taxicab metaphor is related to the cryptocurrency that this book is ostensibly about! You might have figured out that the decentralized Monero Taxicab Network is an overt analogy for the Monero cryptocurrency network, which needs to provide fair global service without any central authority. 

Each trip corresponds to a Monero transaction, pending in the memory pool until it is selected for a spot in a car/block. The taxi drivers represent miners. Both carry out an easy important jobs (taxi drivers plan routes; miners collect and validate transactions), yet are forced to compete against other drivers/miners in a useless difficult nonce task. This barrier randomizes who succeeds first - thus statistically distributing most of the cars/blocks to honest drivers/miners. Whichever taxi driver submits their route first is rewarded with a bonus from the Monero Taxicab Company and fare from each of the riders who obtained a spot. Likewise, miners are rewarded with a commission (called the coinbase or block reward) for completing each block, and they also collect fees from the transactions included in the block.

### 4.3.4 Miners are paid for their service

Each time a miner successfully mines a block (i.e. is the first to find a nonce that completes the next block on the longest chain) they are paid two different ways.

1) First, the miner receives a reward for contributing a completed block of validated transactions. This block reward is analogous to the cash bonus that the taxi network paid drivers that submitted completed routes. All miners, upon receiving and confirming the solved block, add this freshly-minted coinbase to the address of the miner who found the valid nonce first.

2) Secondly, the miner collects fees that were included with the transactions. Monero users can increase the likelihood that a miner includes their transaction sooner by including a larger fee.

It is a common misconception that miners are “finding” or “creating” coins. Actually, miners are simply validating transactions, and are paid for their work with new coins. This introduction of new moneroj is referred to as coin emission.

When Monero was launched, the coin emission rate was more than 30 XMR every 2 minutes. This reward will smoothly decrease until it reaches 0.6 XMR per 2-minute block in 2022. Monero's continuous decrease is designed to provide a more stable economic environment for miners, compared to other cryptocurrencies' dramatic halving events, when the block reward is abruptly substantially reduced. After 2022, Monero's tail emission will stay constant, guaranteeing that mining a block will always reward 0.6 XMR.

Many cryptocurrencies have a fixed cap on coin emission, with a hard limit on maximum supply. Once the supply cap is reached, there will be no new coins introduced for miners, who will be forced to subsist entirely on fees. For example, in Bitcoin, this paradigm shift in financial incentives will occur around 2140, when the supply reaches 21 million Bitcoins and ceases to increase any further. This approach is often touted as a benefit to remain “deflationary,” however these arguments are often based on conflating the concept of an inflating monetary supply with a different use of the word “inflation” to describe an undesirable decrease in spending power of a currency.

The annual supply increase from Monero's 0.6 XMR tail emission is less than 1% per year. While developers created tail emission to incentivize miners long-term, a neat by product is its easy comparison to to asset backed financial systems. The tail emission rate of supply increase is comparable to the annual gold supply increase globally, which in modern civilization has historically been the purest and most stable form of money. Since the miners will always be able to collect fees, the guaranteed coinbase payments provide greater financial stability for the miners in the long run. This social contract ensures that the miners remain incentivized to use their equipment to secure the Monero network.

[![Figure 4.7](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-4.3.3%20rewards.png)](https://masteringmonero.com)
> Figure 4.7 - A miner receives two types of payments each time they mine a block: 1) the fees included with each transaction, and 2) a block reward consisting of freshly-minted moneroj.

## 4.4 Proof of Work systems

Now we'll step away from the taxi analogy and directly discuss the systems in place to ensure fairness in Monero. This process of coupling important network functions with the search for a useless nonce is referred to as a Proof of Work system. Many cryptocurrencies are built on PoW-based consensus, and there are differences among various implementations with different characteristics. However, they share a common theme of enforcing decentralization by requiring validation to be submitted with a nonce. Sometimes the nonce itself is referred to as the “proof of work,” referring to the piece of data that was hard to find/create and easy to verify, such as the taxi drivers' anagrams.

Miners measure how quickly they can work toward mining blocks in “hashes per second”, abbreviated H/s. Each miner can measure their hashrate, which varies depending on the equipment that they are using to mine. The “network hashrate” refers to the total hashrate of all the miners working on preparing blocks.

### 4.4.1 Benefits

#### 4.4.1.1 Censorship resistance

In PoW systems, the nonce-finding competition described above randomizes which miner's version is accepted as the latest block on the longest chain. As mentioned in the taxi analogy, the PoW framework prevents effective censorship. Some malicious miner in the Monero network may try to provide preferential treatment or exclude certain transactions in the memory pool, however an honest Monero miner will simply include those transactions in the next block.

#### 4.4.1.2 Double-spend attack prevention

There is another blockchain challenge solved by PoW systems that was not included in the taxi analogy. Specifically, a malicious miner might try to double spend an output. This refers to an attack where the miner creates alternative blocks to undo their past transactions and steal back the money for themselves. The attack would have to proceed in this manner:

* Malicious miner Martin broadcasts a transaction sending some of his moneroj to victim “Valerie”.
* When the “Martin >> Valerie” transaction is mined onto the blockchain, Valerie believes she has been paid.
* Martin takes whatever he was buying from Valerie...
* ... then Martin mines a different version of the block that originally contained the Martin >> Valerie transaction. 
* In Martin's alternative version, the transaction to Valerie doesn't exist! Instead, his second version contains a transaction that sends that moneroj to one of his wallets (Martin >> Martin), instead of Valerie's.
* If Martin can quickly mine enough blocks to make his chain the longest, then the network will accept his alternate reality. In practice, the infeasibility of this step prevents double-spend attacks from occurring.
* Since the key image for Martin's output appears on the chain (now associated with the transaction to himself), the network will no longer accept the “Martin >> Valerie” transaction as valid since the key image associated with that output is already spent.

At this point, Martin has left with whatever he bought from Valerie and has also stolen back the moneroj that he initially used to pay her.    

Thankfully, PoW systems prevent an attacker from sustaining this type of double-spend attack, by limiting the speed with which they can generate blocks. Recall that miners will always follow the longest blockchain, so the malicious miner would have to change the block with the previous transaction then re-mine every block afterward, fast enough to overtake the length of the main chain. Since the malicious miner will be working alone to generate the altered blocks, against the hashrate of the entire rest of the network maintaining the original ledger, the attacker will be unable to catch up. This type of attack could only feasibly succeed if the malicious miner has as much computing power as the entire rest of the network combined. For this reason, the term 51% attack is often used to indicate that some sort of malicious activity would require majority hashrate.

[![Figure 4.8](https://raw.githubusercontent.com/monerobook/monerobook/master/resources/img/mm-c04i03%2051%20attack.png)](https://masteringmonero.com)
> Figure 4.8 - The dishonest miner at the bottom attempts a double-spend attack by creating a different version of an already-mined block. All of the honest miners working together produce blocks faster than the malicious miner, so the attacker's chain with the alternative transaction is discarded.

A cryptocurrency with more miners and a greater total network hashrate will be more difficult to attack in this way, since the malicious miner must have more computing power than the rest of the global network. Increasing the total hashrate by including more miners helps to secure the network against attacks.

### 4.4.2 The “difficulty” adjusts time between blocks

The Monero network aims to add a new block onto the chain approximately every two minutes. With each mined block, some transactions are moved from the pending memory pool onto the confirmed blockchain. If the average blocktime becomes too long, transactions will be too slow to confirm. If the average blocktime is too short, then the network could get out of sync more often.

The network influences how quickly blocks are mined by adjusting the difficulty of the nonce puzzle. As more miners join the network over time, their collective guessing power (hashrate) results in blocks being completed more frequently (conceptually: if you double the number of people searching for something, the group will probably find it in half the time). This would statistically cause miners to find blocks faster than the target blocktime of 2 minutes. To compensate for this, the difficulty of the puzzle is increased, meaning that it takes longer to find a nonce that matches the arbitrary requirements. Likewise, the difficulty can be adjusted to be easier if mining power decreases, causing blocks to be completed too infrequently.

In the taxi network analogy from the previous section, the difficulty of the letter rearrangement task could be similarly arbitrarily adjusted by requiring more or fewer words in the nonce sentences. If 20% of the taxi drivers (miners) did not participate one day, then it would take longer on average for route plan blocks (completed with nonces) to be submitted, so some cars would be idling with no driver. To correct this, the taxi drivers would agree to lower the nonce requirements from 50 words to 40 words. This would put the drivers back in sync with the availability of cars.

Difficulty increases proportionally with total network hashrate to keep the flow of blocks constant.

### 4.4.3 The CryptoNight algorithm

Monero uses a variation of the CryptoNight PoW algorithm, which is significantly different than the systems used by most other cryptocurrencies. One of Monero's defining features is its use of a PoW function that is difficult to optimize for specialized mining equipment.

 In most contexts, 'optimization' is a good thing, so you might be surprised that Monero's PoW algorithm intentionally stymies accelerating mining speeds. This is because the ability to create overpowered mining equipment can lead to a dangerous centralization of miners. These risks are perfectly illustrated in the history of Bitcoin mining.

#### 4.4.3.1 Context: The history of Bitcoin mining

When cryptocurrencies entered the scene with Bitcoin's appearance in 2009, mining occurred exclusively on computer CPUs. Since the network mining difficulty adjusts to the current total hashrate, CPU mining was adequately profitable in the early days. CPU miners have Bitcoin hashing power on the order of 1,000,000 H/s, written as 1 MH/s for convenience.

Soon, graphics cards were repurposed for mining cryptocurrencies. GPUs are able to attack the mining problem orders of magnitude faster, around 100 MH/s. Since the network difficulty adjusted based on the GPU miners, the CPU miners could not compete (i.e. mining rewards were insufficient to pay for the equipment and electricity costs).

Next, application-specific integrated circuits (ASICs) were built for the sole purpose of mining Bitcoin. These special devices are quite expensive, and mine many thousands of times faster than GPUs - more than 1,000,000 MH/s. By now, the Bitcoin network difficulty has increased to accommodate the ASICs, consequently pushing the CPU and GPU miners out of business.

Bitcoin was initially launched with the vision that anybody in the world with a computer could begin mining to secure the network and obtain some bitcoins as a reward. Unfortunately, the creation and proliferation of ASICs very effectively ended this dream. If you wish to begin mining Bitcoin now, you will have to obtain an ASIC for hundreds or thousands of Euros. 

This ASIC takeover put the vast majority of Bitcoin miners out of business. The network began its existence secured by scores of computer geeks scattered across the globe, all participating on their personal computers and graphics cards. Sadly, this true decentralization of Bitcoin is a bygone era. Now the network is dominated by several large corporations with massive ASIC farms, who have effectively become the Bitcoin backbone.

#### 4.4.3.2 ASICs enable dangerous centralization

Since many of the main cryptocurrencies are dominated by ASIC miners, it is worth giving consideration to the topic and its risks. Centralization occurs in two forms: ASICs are only produced by a few companies (centralization of manufacturing) and subsequent mining tends to be limited to a few large farms (centralization of mining).

Centralization of ASIC manufacturing and mining to a few large corporations allows hackers, attackers, and governments to exert disproportionately large influence over the network and its operation. This begins to nullify many of the benefits of decentralization. For example:

Universal access to mining flourished in the days of CPU and GPU mining, which uses mostly unregulated general-purpose hardware. However, mining now requires specialized hardware, which is at much greater risk of regulation and control. It is possible that some government may impose bans or require licenses to manufacture/own ASICs.

Censorship resistance is weakened if the majority of Monero's hash power is controlled by large mining farms that can be pressured into confirming or censoring certain transactions. It would be difficult to exert this influence over a global collection of amateur miners, and much easier to impose this kind of activity on centralized mining corporations.

Network resilience may be catastrophically undermined if a malicious manufacturer (or one that is following government orders) includes an secret ASIC killswitch to remotely control or shut down their mining equipment. This creates a single point of failure, whose activation would instantly kill most of the network hashrate. This would plunge the network into a sudden vulnerable state with dramatically lessened hashrate to secure the currency. This risk is much higher if a small number of ASIC manufacturers control the majority of production.

The ASIC takeover of Bitcoin is complete. While there are still some small-time miners with ASICS working in pools, large mining farms dominate the network hashrate. Concerningly, the majority of Bitcoin ASICs are designed, manufactured, and shipped by a single manufacturer - in stark contrast to the Bitcoin's early days, when miners used every brand, model, and flavor of CPU and GPU to mine. The prevalence of ASICs would be much less risky if there was a diverse and competitive ASIC market.

#### 4.4.3.3 Monero actively resists ASICs

Due to underlying egalitarian principles, the Monero community does not approve of ASICs and their inevitable centralization of mining power. While the “CPU-hard” hash algorithm (SHA-256) used by Bitcoin is amenable to ASIC optimization, Monero deters ASIC development by using a “memory-hard” algorithm (CryptoNight) that is difficult to accelerate. 
Consequently, CPU and GPU mining are both feasible for Monero, even in 2018. There are currently billions of existing devices (any modern x86 CPU and many GPUs) that are capable of mining Monero, so the process is accessible to any internet-connected individual. In fact, it is even possible to mine Monero in a web browser from any phone or computer!

In early March 2018, the Monero community was shocked to realize that CryptoNight ASICs had been secretly produced and were mining Monero! These devices purported to mine Monero 25 times faster than the leading GPUs, and retrospective hashrate analysis suggests that they accounted for nearly half of the Monero network hashrate in late 2017 and early 2018.

Since the CryptoNight algorithm was designed as a memory-hard function specifically to “close the gap between CPU (majority) and GPU/FPGA/ASIC  (minority) miners,” the existence of these ASICs was an unexpected discovery. While the CryptoNote authors observe that, “It is appropriate that some users can have a certain advantage over others,” they propose that “their  investments  should  grow  at  least  linearly  with  the  power.” Naturally, a newer computer or a nicer graphics card will mine more efficiently than older equipment, but ASICs create an extremely disproportionate distribution of hashrate.

The Monero community reacted quickly, proactively taking steps to mitigate ASIC mining before the existence of the devices was even fully confirmed. The spring 2018 Monero routine upgrade included a minor tweak to the CryptoNight algorithm, designed to affect ASICs differently than GPU/CPU miners. This slight variation did not change the difficulty or behavior of the algorithm, so the CPU/GPU miners were able to easily adjust to the new variant when they upgraded with the network.

ASICs, on the other hand, are fundamentally incapable of adapting to new (minor or major) variations. One can think of ASICs as workers that are trained to do one task extremely quickly, but cannot learn to do anything else. The algorithm to be executed is physically etched into the ASIC circuits, so they cannot be reprogrammed or repurposed. 

When the minor CryptoNote tweak was implemented at block 1546000, the ASICs became instantly incompatible with the network, and approximately half of the total hashrate vanished. Since the ASICs were unable to adjust to process blocks by a modified algorithm, any blocks they produce are now immediately rejected by the Monero network as invalid.

For the time being, it appears that the Monero network has successfully mitigated the unexpected ASIC threat. To continue discouraging ASICs, Monero now slightly changes the mining algorithm at each network update. They are also exploring entirely new algorithms to safeguard the network from ASICs long term. Since Monero carries out routine hard forks every 6 months, this should disincentivize attempts to produce Monero ASICs, since each expensive and lengthy redesign would be promptly rendered obsolete.

### 4.4.4 Brief note on PoW alternatives

There are alternative systems for maintaining fairness besides proof of work; examples include proof of stake, proof of space, proof of bandwidth, and even hybrids between multiple types. Each system has its own strengths and drawbacks. PoW is currently the most widely used and field-tested consensus mechanism, and is currently the only system utilized by Monero.


## 4.5 Cryptographic concepts for proof of work

Throughout this chapter, we've focused on the functionality of hashes and nonces, describing them primarily through analogies. If you want to learn how they really work, the remainder of the chapter introduces the actual cryptographic principles.

### 4.5.1 Hashes (general concept)

Hash functions are a cryptographic tool that can digest any input data, and produce a unique fingerprint output. These algorithms are designed so that any alteration to the input, even very minor changes, will result in an entirely different output. The term “hash” can be used to refer to both the function itself and its output for a particular input.

Adding, removing, or changing even a single character will result in a totally different hash. Consider the message “Please send 50 euros to Jen.” We can run the string through one of these algorithms to produce its hash a2d2a9059ed8d323 The below table shows how the hash output changes dramatically with any modification of the input:


Input | Output | Comment
--- | --- | ---
Please send 50 EUR to Jen. | a2d2a9059ed8d323 | True message
Please send 500 EUR to Jen. | 05cbdd8dd96718ac | Added an extra ‘0’ to amount
Please send 60 EUR to Jen. | f5087a90b63b1777 | Changed ‘5’ to ‘6’
Please send 50 EUR to Jon. | ffd424b7077a3c58 | Changed recipient to ‘Jon’
Please send 50 EUR to Jen. | a2d2a9059ed8d323 | Same input = same output!

     The example output here is the first 16 characters of each input’s SHA-256 hash
	$ echo {input} | sha256sum | cut -c1-16

Hash functions are heavily utilized in many cryptocurrency security features. Cryptographic hash functions are engineered to be collision-resistant, which means that it is hard to find two input messages that collide to produce the same output digest. This is central to the immutability (tamperproof nature) of the blockchain, since any attempts to change data in a past block will result in an entirely different hash output for that and all subsequent blocks.

This notion of an expanding append-only database with each group of entries cryptographically secured by hashes to the previous block is a key concept behind the blockchain revolution.

### 4.5.2 Nonces (general concept)

The term nonce refers to a puzzle that is not inherently physically/mathematically meaningful. For example, consider the following “fill-in-the-blank” questions that a teacher might give their students:

Puzzle A) The Esperanto word for "c\_\_\_" inspired the name “Monero”
	Acceptable answer: “coin”
Puzzle B) 1 kilogram is equal to "\_\_\_\_" grams.
	Acceptable answer: 1000
Puzzle C) This 3-digit prime number "3\_\_\_" does not repeat any digits
	Acceptable nonces: any of {307, 317, 347, 349, 359, etc…}
Puzzle D) This 5-digit prime number "7\_\_\_" does not repeat any digits
	Acceptable nonces: any of {71263, 72169, 73609, 74869, etc…}

Puzzle A and B are both meaningful, and each have one correct answer (A: “coin” B: “1000”) that the student will want to remember for future problems. Thus, these answers are not considered “nonces”.

However, puzzles C and D are both “busy work” tasks that are hard to solve, and do not contribute insight to any real problem. There are multiple solutions that all satisfy the nonce requirement; for question C, the answer “359” is equally as valid as “307.” 

A student that spends an hour testing various numbers to come up with the answer “359” for puzzle C has to start the search for a valid nonce from scratch upon encountering each variation on the puzzle, e.g. “This 3-digit prime number “6\_\_\_” does not repeat any digits.”

If you only had a pencil and paper (or even with a calculator), would you rather solve puzzle C or puzzle D? Probably puzzle C, since you're likely to find a valid 3-digit answer faster than a valid 5-digit answer. You can see how the difficulty of the problem can be arbitrarily adjusted by changing how many digits are required.

## 4.6 PoW concept summary

Cryptocurrencies use the hash of each block to ensure that its contents have not been changed, since modifying a single character would be instantly obvious due to the radically-different hash (which propagates through subsequent blocks). The hash of a block includes all of its contents: transactions, headers, the hash of the previous block, and a nonce field.

To work on completing a block, the miners must randomly guess at values for the nonce, attempting to  find one that causes the hash of the entire block to produce an output below a certain threshold, which is determined by the current network difficulty. Since it is impossible to predict how changing the inputs to a hash function will affect its outputs, the miners must brute force random nonces by trial and error until they find one that produces an output hash that satisfies the current network difficulty.

The network raises or lowers this threshold to influence the mining difficulty, in order to maintain a 2-minute block time independent of changes in the total hashrate.
